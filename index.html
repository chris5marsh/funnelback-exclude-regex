<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="author" content="University of York">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>University of York</title>
  <meta name="description" content="" />
  <meta name="keywords" content="" />

  <link rel=”openorg” href="https://www.york.ac.uk/.well-known/profile.rdf"/>
  <link rel="search" type="application/opensearchdescription+xml" title="University of York" href="https://www.york.ac.uk/static/stable/opensearch.xml">
  <link rel="shortcut icon" href="https://www.york.ac.uk/static/stable/img/favicon.ico">
  <link rel="icon" type="image/x-icon" href="https://www.york.ac.uk/static/stable/img/favicon.ico">

  <!-- Typekit script -->
  <link rel="stylesheet" href="https://use.typekit.net/dvj8rpp.css">
  <link rel="stylesheet" href="https://www.york.ac.uk/static/stable/css/styles.min.css" media="screen">

  <script src="https://www.york.ac.uk/static/stable/js/modernizr.min.js"></script>
  <script src="https://www.york.ac.uk/static/stable/js/app.min.js"></script>

  <!-- Print styles -->
  <link rel="stylesheet" href="https://www.york.ac.uk/static/stable/css/print.min.css" media="print">

</head>

<body id="homepage">

<a href="#Main-Content" class="o-skip-link">Skip to content</a>

<header class="c-main-header" role="banner">
  <div class="o-wrapper o-grid">
    <div class="o-grid__row">
      <div class="o-grid__box o-grid__box--threequarters o-grid__box--threequarters@medium o-grid__box--threequarters@small o-grid__box--threequarters@tiny">
        <h2 class="c-main-header__title"><a class="c-main-header__link" href="https://www.york.ac.uk"><img class="c-main-header__logo" src="https://www.york.ac.uk/static/stable/img/logo.svg" alt="University of York logo"></a></h2>
      </div>
      <div class="o-grid__box o-grid__box--quarter o-grid__box--quarter@medium o-grid__box--quarter@small o-grid__box--quarter@tiny">
        <form action="https://www.york.ac.uk/search" method="get" class="c-form c-form--joined c-form--header">
          <fieldset>
            <div class="c-form__element">
              <input class="c-form__input c-form__input--text" type="text" id="q" name="q" placeholder="Search york.ac.uk" />
              <input type="hidden" name="site" value="yorkweb">
              <a class="c-btn c-btn--medium js-submit-form" href="https://www.york.ac.uk/search" role="button"><i class="c-icon c-icon--search"></i></a>
            </div>
          </fieldset>
        </form>
        <a href="#Mobile-Search-2" class="c-mobile-search-button js-toggle-button"><i class="c-icon c-icon--search"></i></a>
      </div>
    </div>
  </div>
</header>
<form action="https://www.york.ac.uk/search" method="get" class="c-form c-form--joined c-form--mobile-search" id="Mobile-Search-2">
  <fieldset class="c-form__fieldset">
    <legend class="c-form__legend">Search york.ac.uk</legend>
    <div class="o-grid">
      <div class="o-grid__row">
        <div class="o-grid__box o-grid__box--full">
          <div class="c-form__element">
            <input class="c-form__input c-form__input--text" type="text" id="q" name="q" placeholder="Search york.ac.uk">
            <input type="hidden" name="site" value="yorkweb">
            <a class="c-btn c-btn--medium js-submit-form" href="#" role="button">Search</a>
          </div>
        </div>
      </div>
    </div>
  </fieldset>
</form>

<div class="o-wrapper o-wrapper--wide c-page-title__wrapper o-grid">
  <div class="c-page-title c-page-title--bordered">
    <h1 class="c-page-title__header">Update the excludes file for Funnelback</h1>
  </div>
</div>

<div class="o-wrapper o-wrapper--main js-wrapper--main">

  <div class="c-alert c-alert--success" role="alert" id="success-message">
    <div class="c-alert__content">
      <p><strong>Congratulations!</strong> You have successfully created a new excludes file.</p>
      <p><a href="#" target="_blank" class="c-btn c-btn--medium download">Download the new excludes file</a></p>
    </div>
  </div>

  <div class="c-alert c-alert--danger" role="alert" id="failure-message">
    <div class="c-alert__content">
      <p><strong>The excludes file was not created.</strong> Please try again</p>
    </div>
  </div>

  <form action="#" method="get" class="c-form c-form--stacked" id="excludes-form">
    <div class="o-grid">
      <div class="o-grid__row">
        <div class="o-grid__box o-grid__box--full">
          <div class="c-form__element">
            <label class="c-form__label" for="excludes">Enter URLs to exclude, one per line<br><small>If you need a regex as part of the URL, use the form <code>new RegExp("...")</code></small></label>
            <textarea class="c-form__input c-form__input--textarea c-form__input--textarea--treble" id="excludes" name="excludes" placeholder=""></textarea>
          </div>
        </div>
      </div>
      <div class="o-grid__row">
        <div class="o-grid__box o-grid__box--full">
          <button class="c-btn c-btn--medium">Submit</button>
        </div>
      </div>
    </div>
  </form>

</div>

<footer class="c-footer-main" role="contentinfo">...</footer>

<script type="text/javascript">
  jQuery(function() {
    var $ = jQuery;
    // Hide success/failure messages
    var successMessage = $('#success-message');
    successMessage.hide();
    var failureMessage = $('#failure-message');
    failureMessage.hide();
    // Load input.txt into textarea
    $.get('input.txt').then(function(data) {
      $('#excludes').val(data);
    });
    // On submit, run the script and return output.txt to the browser
    $('#excludes-form').submit(function(e) {
      successMessage.hide();
      failureMessage.hide();
      e.preventDefault();
      $.post('/api', { value: $('#excludes').val() }, function(data) {
        var dataJson = JSON.parse(data);
        if (dataJson.error) {
          failureMessage.show();
        } else {
          $('.download').attr({ "href": dataJson.success });
          successMessage.show();
        }
      })
    });
  });
</script>

</body>

</html>